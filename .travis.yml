# Config file for automatic testing at travis-ci.org

language: python
python:
  - 3.6

before_install:
  # Build libnghttp2 from source

  # Get source code as tar-ball from GitHub and extract it
  - wget https://github.com/nghttp2/nghttp2/releases/download/v1.25.0/nghttp2-1.25.0.tar.gz
  - tar xzf nghttp2-1.25.0.tar.gz
  - cd nghttp2-1.25.0/

  # Only build shared library
  - ./configure --enable-lib-only --enable-shared --disable-static
  - make

  # Install to OS
  - sudo make install

  # Add ldconfig file for /usr/local/lib directory to be able to load shared
  # libraries from there
  - sudo sh -c 'echo /usr/local/lib > /etc/ld.so.conf.d/local.conf'
  - sudo ldconfig

install: pip install -U tox-travis codecov

script: tox

# Upload combined coverage reports to codecov.io. The reports of the different
# Python environments are combined in an extra tox testenv.
after_success: codecov --file .tox/coverage.xml

# Deployment to pypi
deploy:
  provider: pypi
  user: f3anor
  password:
    secure: k/Pe7ZG/4nbe1lKuXu5F9j5zWEt2ELapP0mCeXj0LsNU31uf9eXl48ErWV+NnU2DIiYsJOle7Xm7+7W3pMgTH2l+kRLHXDh5Gm9GwmC44RhUHb5c8lLCDJq1ePObRgR+xPa5205lmEApGSbtMVwqSj9eJ85qQn3iEU+uvdMAlyiiopj+5xw8vSBgy/vs66h/Z8z7dvXpAd4VP9e6DnYJeFGNIAJaZAL3sVNYDofKpaH1NHn4LpLgKQ18g0WlQuI8Y+aJnSjoxdsJjYnVUVzw7F+nd/qwc2ut1RgK5AUD/ZNxJ72tdE4UMhMHIdn9KyO60jnIxFXf2TekVXxTfYbaNMNO2HJWHznwoInNAWcr011SbrMsSQGWsAzBczCOaF4+gIqnJe8ZH0AvUFKdz0bVy3DH+l+rP1TpOOHsPh1FAqk5uS2dMNgtiK9G13ejnTtoJXllHkm6kqgqz7zS89d0ssk1ZLxxGRr27vM3KLkD0IMAfZRdw9uFj/igPT7m4Uz/ZbY1fQQcgJk5pNb/x6M2lZ/QiRteixUZe4IVv6C0XeX6hbm4j0AmKIXnylJmMgsEM3Np1YSKNbhTAZPkdlfjeOOgZ9d1xEms/dQOeRh5yEIdDMJCQlzhMELgAHK5mFozRqkXA23xvfAOD3RU/o7wqdLzL1WZXjEGsTYV+lAdpqs=
  on:
    tags: true
